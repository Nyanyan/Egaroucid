/*
    Egaroucid Project

    @file last_flip_generic.hpp
        calculate number of flipped discs in the last move without AVX2
    @date 2021-2025
    @author Takuto Yamana
    @license GPL-3.0 license
*/

#pragma once
#include "setting.hpp"
#include "common.hpp"
#include "bit.hpp"

/*
    @brief constant of number of flipping discs
*/

#if LAST_FLIP_PASS_OPT
// N_LAST_FLIP_BOTH[player_8bit][place] = n_flip_opponent << 8 | n_flip_player
// opponent_8bit = 0xff ^ player_8bit ^ (1 << place)
constexpr uint16_t N_LAST_FLIP_BOTH[N_8BIT][HW] = {
    {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006}, 
    {0x0100, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005}, {0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005}, 
    {0x0001, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003, 0x0004}, {0x0000, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003, 0x0004}, 
    {0x0200, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002, 0x0003, 0x0004}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0003, 0x0004}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002, 0x0003}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002, 0x0003}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002, 0x0003}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001, 0x0002, 0x0003}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0003}, 
    {0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002}, {0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0100, 0x0001, 0x0002}, 
    {0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0001, 0x0002}, {0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0001, 0x0002}, 
    {0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001, 0x0002}, {0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001, 0x0002}, 
    {0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0001, 0x0002}, {0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0001, 0x0002}, 
    {0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002}, {0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002}, 
    {0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002}, {0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001, 0x0002}, 
    {0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001, 0x0002}, {0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001, 0x0002}, 
    {0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0001, 0x0002}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002}, 
    {0x0004, 0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0003, 0x0003, 0x0003, 0x0103, 0x0000, 0x0100, 0x0001}, 
    {0x0100, 0x0000, 0x0102, 0x0002, 0x0102, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0100, 0x0001}, 
    {0x0001, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0001}, 
    {0x0200, 0x0000, 0x0000, 0x0201, 0x0101, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0001}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0001}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0001}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0100, 0x0001}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0001}, 
    {0x0003, 0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001}, {0x0000, 0x0002, 0x0002, 0x0202, 0x0000, 0x0000, 0x0200, 0x0001}, 
    {0x0100, 0x0000, 0x0101, 0x0201, 0x0000, 0x0000, 0x0200, 0x0001}, {0x0000, 0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0200, 0x0001}, 
    {0x0001, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0001}, {0x0000, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0001}, 
    {0x0200, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0200, 0x0001}, {0x0000, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0001}, 
    {0x0002, 0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001}, {0x0000, 0x0001, 0x0301, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001}, 
    {0x0100, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001}, {0x0000, 0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0001}, 
    {0x0001, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0001}, {0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0001}, 
    {0x0500, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0500, 0x0001}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001}, 
    {0x0005, 0x0004, 0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0100}, {0x0000, 0x0004, 0x0004, 0x0004, 0x0004, 0x0104, 0x0000, 0x0100}, 
    {0x0100, 0x0000, 0x0103, 0x0003, 0x0003, 0x0103, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0003, 0x0003, 0x0003, 0x0103, 0x0000, 0x0100}, 
    {0x0001, 0x0100, 0x0000, 0x0102, 0x0002, 0x0102, 0x0000, 0x0100}, {0x0000, 0x0100, 0x0000, 0x0102, 0x0002, 0x0102, 0x0000, 0x0100}, 
    {0x0200, 0x0000, 0x0000, 0x0202, 0x0002, 0x0102, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0100}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0201, 0x0101, 0x0000, 0x0100}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0201, 0x0101, 0x0000, 0x0100}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0301, 0x0101, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0100}, 
    {0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100}, {0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0200, 0x0000, 0x0100}, 
    {0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0200, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0200, 0x0000, 0x0100}, 
    {0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0200, 0x0000, 0x0100}, {0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0200, 0x0000, 0x0100}, 
    {0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0200, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100}, 
    {0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100}, {0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100}, 
    {0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100}, 
    {0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0100}, {0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0100}, 
    {0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0500, 0x0000, 0x0100}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0100}, 
    {0x0004, 0x0003, 0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0003, 0x0003, 0x0003, 0x0203, 0x0000, 0x0000, 0x0200}, 
    {0x0100, 0x0000, 0x0102, 0x0002, 0x0202, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0000, 0x0002, 0x0002, 0x0202, 0x0000, 0x0000, 0x0200}, 
    {0x0001, 0x0100, 0x0000, 0x0101, 0x0201, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0100, 0x0000, 0x0101, 0x0201, 0x0000, 0x0000, 0x0200}, 
    {0x0200, 0x0000, 0x0000, 0x0201, 0x0201, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0000, 0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0200}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0200}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0500, 0x0000, 0x0000, 0x0200}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0200}, 
    {0x0003, 0x0002, 0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300}, {0x0000, 0x0002, 0x0002, 0x0302, 0x0000, 0x0000, 0x0000, 0x0300}, 
    {0x0100, 0x0000, 0x0101, 0x0301, 0x0000, 0x0000, 0x0000, 0x0300}, {0x0000, 0x0000, 0x0001, 0x0301, 0x0000, 0x0000, 0x0000, 0x0300}, 
    {0x0001, 0x0100, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0300}, {0x0000, 0x0100, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0300}, 
    {0x0200, 0x0000, 0x0000, 0x0500, 0x0000, 0x0000, 0x0000, 0x0300}, {0x0000, 0x0000, 0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300}, 
    {0x0002, 0x0001, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400}, {0x0000, 0x0001, 0x0401, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400}, 
    {0x0100, 0x0000, 0x0500, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400}, {0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400}, 
    {0x0001, 0x0500, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0500}, {0x0000, 0x0500, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0500}, 
    {0x0600, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0600}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0006, 0x0005, 0x0004, 0x0003, 0x0002, 0x0001, 0x0000, 0x0000}, {0x0000, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0005, 0x0000}, 
    {0x0100, 0x0000, 0x0104, 0x0004, 0x0004, 0x0004, 0x0004, 0x0000}, {0x0000, 0x0000, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0103, 0x0003, 0x0003, 0x0003, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0103, 0x0003, 0x0003, 0x0003, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0203, 0x0003, 0x0003, 0x0003, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0003, 0x0003, 0x0003, 0x0003, 0x0000}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0202, 0x0002, 0x0002, 0x0000}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0202, 0x0002, 0x0002, 0x0000}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0302, 0x0002, 0x0002, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0002, 0x0002, 0x0002, 0x0000}, 
    {0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000}, {0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0101, 0x0001, 0x0000}, 
    {0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0101, 0x0001, 0x0000}, {0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0101, 0x0001, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0101, 0x0001, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0101, 0x0001, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0101, 0x0001, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000}, 
    {0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000}, {0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000}, 
    {0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000}, {0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000}, 
    {0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0301, 0x0001, 0x0000}, {0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0301, 0x0001, 0x0000}, 
    {0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0401, 0x0001, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0001, 0x0000}, 
    {0x0004, 0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0003, 0x0003, 0x0003, 0x0103, 0x0000, 0x0100, 0x0000}, 
    {0x0100, 0x0000, 0x0102, 0x0002, 0x0102, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0100, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0201, 0x0101, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0000}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0000}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0100, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0000}, 
    {0x0003, 0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000}, {0x0000, 0x0002, 0x0002, 0x0202, 0x0000, 0x0000, 0x0200, 0x0000}, 
    {0x0100, 0x0000, 0x0101, 0x0201, 0x0000, 0x0000, 0x0200, 0x0000}, {0x0000, 0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0200, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000, 0x0200, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000}, 
    {0x0002, 0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000}, {0x0000, 0x0001, 0x0301, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000}, 
    {0x0100, 0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000}, {0x0000, 0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000}, 
    {0x0001, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000}, {0x0000, 0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000}, 
    {0x0500, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0500, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0005, 0x0004, 0x0003, 0x0002, 0x0001, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0004, 0x0004, 0x0004, 0x0004, 0x0004, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0103, 0x0003, 0x0003, 0x0003, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0003, 0x0003, 0x0003, 0x0003, 0x0000, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0202, 0x0002, 0x0002, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0002, 0x0002, 0x0002, 0x0000, 0x0000}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000, 0x0000}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000, 0x0000}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0301, 0x0001, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0001, 0x0000, 0x0000}, 
    {0x0003, 0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000}, {0x0000, 0x0002, 0x0002, 0x0102, 0x0000, 0x0100, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0101, 0x0101, 0x0000, 0x0100, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0000, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0300, 0x0000, 0x0100, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000}, 
    {0x0002, 0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000}, {0x0000, 0x0001, 0x0201, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0300, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000}, 
    {0x0001, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000, 0x0000}, {0x0000, 0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000, 0x0000}, 
    {0x0400, 0x0000, 0x0000, 0x0000, 0x0000, 0x0400, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0004, 0x0003, 0x0002, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0003, 0x0003, 0x0003, 0x0003, 0x0000, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0102, 0x0002, 0x0002, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0002, 0x0002, 0x0002, 0x0000, 0x0000, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0201, 0x0001, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0001, 0x0001, 0x0000, 0x0000, 0x0000}, 
    {0x0002, 0x0001, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0001, 0x0101, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0200, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000}, 
    {0x0001, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0200, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0000}, 
    {0x0300, 0x0000, 0x0000, 0x0000, 0x0300, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0003, 0x0002, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0002, 0x0002, 0x0002, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0101, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0001, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0001, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0100, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0200, 0x0000, 0x0000, 0x0200, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0002, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0001, 0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0100, 0x0000, 0x0100, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0001, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, 
    {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}, {0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000}
};
#endif

// if (i & (1 << j))  N_LAST_FLIP[i][j] = N_LAST_FLIP[i ^ (1 << j)][j];	// to use ~player instead of opponent
constexpr uint8_t N_LAST_FLIP[N_8BIT][HW] = {
    {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 1, 2, 3, 4, 5, 6}, {0, 0, 0, 1, 2, 3, 4, 5}, {0, 0, 0, 1, 2, 3, 4, 5}, {1, 0, 0, 0, 1, 2, 3, 4}, {1, 0, 1, 0, 1, 2, 3, 4}, {0, 0, 0, 0, 1, 2, 3, 4}, {0, 0, 0, 0, 1, 2, 3, 4},
    {2, 1, 0, 0, 0, 1, 2, 3}, {2, 1, 1, 2, 0, 1, 2, 3}, {0, 1, 0, 1, 0, 1, 2, 3}, {0, 1, 0, 1, 0, 1, 2, 3}, {1, 0, 0, 0, 0, 1, 2, 3}, {1, 0, 1, 0, 0, 1, 2, 3}, {0, 0, 0, 0, 0, 1, 2, 3}, {0, 0, 0, 0, 0, 1, 2, 3},
    {3, 2, 1, 0, 0, 0, 1, 2}, {3, 2, 2, 2, 3, 0, 1, 2}, {0, 2, 1, 1, 2, 0, 1, 2}, {0, 2, 1, 1, 2, 0, 1, 2}, {1, 0, 1, 0, 1, 0, 1, 2}, {1, 0, 2, 0, 1, 0, 1, 2}, {0, 0, 1, 0, 1, 0, 1, 2}, {0, 0, 1, 0, 1, 0, 1, 2},
    {2, 1, 0, 0, 0, 0, 1, 2}, {2, 1, 1, 2, 0, 0, 1, 2}, {0, 1, 0, 1, 0, 0, 1, 2}, {0, 1, 0, 1, 0, 0, 1, 2}, {1, 0, 0, 0, 0, 0, 1, 2}, {1, 0, 1, 0, 0, 0, 1, 2}, {0, 0, 0, 0, 0, 0, 1, 2}, {0, 0, 0, 0, 0, 0, 1, 2},
    {4, 3, 2, 1, 0, 0, 0, 1}, {4, 3, 3, 3, 3, 4, 0, 1}, {0, 3, 2, 2, 2, 3, 0, 1}, {0, 3, 2, 2, 2, 3, 0, 1}, {1, 0, 2, 1, 1, 2, 0, 1}, {1, 0, 3, 1, 1, 2, 0, 1}, {0, 0, 2, 1, 1, 2, 0, 1}, {0, 0, 2, 1, 1, 2, 0, 1},
    {2, 1, 0, 1, 0, 1, 0, 1}, {2, 1, 1, 3, 0, 1, 0, 1}, {0, 1, 0, 2, 0, 1, 0, 1}, {0, 1, 0, 2, 0, 1, 0, 1}, {1, 0, 0, 1, 0, 1, 0, 1}, {1, 0, 1, 1, 0, 1, 0, 1}, {0, 0, 0, 1, 0, 1, 0, 1}, {0, 0, 0, 1, 0, 1, 0, 1},
    {3, 2, 1, 0, 0, 0, 0, 1}, {3, 2, 2, 2, 3, 0, 0, 1}, {0, 2, 1, 1, 2, 0, 0, 1}, {0, 2, 1, 1, 2, 0, 0, 1}, {1, 0, 1, 0, 1, 0, 0, 1}, {1, 0, 2, 0, 1, 0, 0, 1}, {0, 0, 1, 0, 1, 0, 0, 1}, {0, 0, 1, 0, 1, 0, 0, 1},
    {2, 1, 0, 0, 0, 0, 0, 1}, {2, 1, 1, 2, 0, 0, 0, 1}, {0, 1, 0, 1, 0, 0, 0, 1}, {0, 1, 0, 1, 0, 0, 0, 1}, {1, 0, 0, 0, 0, 0, 0, 1}, {1, 0, 1, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 0, 0, 0, 1},
    {5, 4, 3, 2, 1, 0, 0, 0}, {5, 4, 4, 4, 4, 4, 5, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {1, 0, 3, 2, 2, 2, 3, 0}, {1, 0, 4, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0},
    {2, 1, 0, 2, 1, 1, 2, 0}, {2, 1, 1, 4, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {1, 0, 0, 2, 1, 1, 2, 0}, {1, 0, 1, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0},
    {3, 2, 1, 0, 1, 0, 1, 0}, {3, 2, 2, 2, 4, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {1, 0, 1, 0, 2, 0, 1, 0}, {1, 0, 2, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0},
    {2, 1, 0, 0, 1, 0, 1, 0}, {2, 1, 1, 2, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {1, 0, 0, 0, 1, 0, 1, 0}, {1, 0, 1, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0},
    {4, 3, 2, 1, 0, 0, 0, 0}, {4, 3, 3, 3, 3, 4, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {1, 0, 2, 1, 1, 2, 0, 0}, {1, 0, 3, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0},
    {2, 1, 0, 1, 0, 1, 0, 0}, {2, 1, 1, 3, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {1, 0, 0, 1, 0, 1, 0, 0}, {1, 0, 1, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0},
    {3, 2, 1, 0, 0, 0, 0, 0}, {3, 2, 2, 2, 3, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {1, 0, 1, 0, 1, 0, 0, 0}, {1, 0, 2, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0},
    {2, 1, 0, 0, 0, 0, 0, 0}, {2, 1, 1, 2, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {1, 0, 0, 0, 0, 0, 0, 0}, {1, 0, 1, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0},
    {6, 5, 4, 3, 2, 1, 0, 0}, {6, 5, 5, 5, 5, 5, 5, 6}, {0, 5, 4, 4, 4, 4, 4, 5}, {0, 5, 4, 4, 4, 4, 4, 5}, {1, 0, 4, 3, 3, 3, 3, 4}, {1, 0, 5, 3, 3, 3, 3, 4}, {0, 0, 4, 3, 3, 3, 3, 4}, {0, 0, 4, 3, 3, 3, 3, 4},
    {2, 1, 0, 3, 2, 2, 2, 3}, {2, 1, 1, 5, 2, 2, 2, 3}, {0, 1, 0, 4, 2, 2, 2, 3}, {0, 1, 0, 4, 2, 2, 2, 3}, {1, 0, 0, 3, 2, 2, 2, 3}, {1, 0, 1, 3, 2, 2, 2, 3}, {0, 0, 0, 3, 2, 2, 2, 3}, {0, 0, 0, 3, 2, 2, 2, 3},
    {3, 2, 1, 0, 2, 1, 1, 2}, {3, 2, 2, 2, 5, 1, 1, 2}, {0, 2, 1, 1, 4, 1, 1, 2}, {0, 2, 1, 1, 4, 1, 1, 2}, {1, 0, 1, 0, 3, 1, 1, 2}, {1, 0, 2, 0, 3, 1, 1, 2}, {0, 0, 1, 0, 3, 1, 1, 2}, {0, 0, 1, 0, 3, 1, 1, 2},
    {2, 1, 0, 0, 2, 1, 1, 2}, {2, 1, 1, 2, 2, 1, 1, 2}, {0, 1, 0, 1, 2, 1, 1, 2}, {0, 1, 0, 1, 2, 1, 1, 2}, {1, 0, 0, 0, 2, 1, 1, 2}, {1, 0, 1, 0, 2, 1, 1, 2}, {0, 0, 0, 0, 2, 1, 1, 2}, {0, 0, 0, 0, 2, 1, 1, 2},
    {4, 3, 2, 1, 0, 1, 0, 1}, {4, 3, 3, 3, 3, 5, 0, 1}, {0, 3, 2, 2, 2, 4, 0, 1}, {0, 3, 2, 2, 2, 4, 0, 1}, {1, 0, 2, 1, 1, 3, 0, 1}, {1, 0, 3, 1, 1, 3, 0, 1}, {0, 0, 2, 1, 1, 3, 0, 1}, {0, 0, 2, 1, 1, 3, 0, 1},
    {2, 1, 0, 1, 0, 2, 0, 1}, {2, 1, 1, 3, 0, 2, 0, 1}, {0, 1, 0, 2, 0, 2, 0, 1}, {0, 1, 0, 2, 0, 2, 0, 1}, {1, 0, 0, 1, 0, 2, 0, 1}, {1, 0, 1, 1, 0, 2, 0, 1}, {0, 0, 0, 1, 0, 2, 0, 1}, {0, 0, 0, 1, 0, 2, 0, 1},
    {3, 2, 1, 0, 0, 1, 0, 1}, {3, 2, 2, 2, 3, 1, 0, 1}, {0, 2, 1, 1, 2, 1, 0, 1}, {0, 2, 1, 1, 2, 1, 0, 1}, {1, 0, 1, 0, 1, 1, 0, 1}, {1, 0, 2, 0, 1, 1, 0, 1}, {0, 0, 1, 0, 1, 1, 0, 1}, {0, 0, 1, 0, 1, 1, 0, 1},
    {2, 1, 0, 0, 0, 1, 0, 1}, {2, 1, 1, 2, 0, 1, 0, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {1, 0, 0, 0, 0, 1, 0, 1}, {1, 0, 1, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 0, 1, 0, 1},
    {5, 4, 3, 2, 1, 0, 0, 0}, {5, 4, 4, 4, 4, 4, 5, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {1, 0, 3, 2, 2, 2, 3, 0}, {1, 0, 4, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0},
    {2, 1, 0, 2, 1, 1, 2, 0}, {2, 1, 1, 4, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {1, 0, 0, 2, 1, 1, 2, 0}, {1, 0, 1, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0},
    {3, 2, 1, 0, 1, 0, 1, 0}, {3, 2, 2, 2, 4, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {1, 0, 1, 0, 2, 0, 1, 0}, {1, 0, 2, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0},
    {2, 1, 0, 0, 1, 0, 1, 0}, {2, 1, 1, 2, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {1, 0, 0, 0, 1, 0, 1, 0}, {1, 0, 1, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0},
    {4, 3, 2, 1, 0, 0, 0, 0}, {4, 3, 3, 3, 3, 4, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {1, 0, 2, 1, 1, 2, 0, 0}, {1, 0, 3, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0},
    {2, 1, 0, 1, 0, 1, 0, 0}, {2, 1, 1, 3, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {1, 0, 0, 1, 0, 1, 0, 0}, {1, 0, 1, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0},
    {3, 2, 1, 0, 0, 0, 0, 0}, {3, 2, 2, 2, 3, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {1, 0, 1, 0, 1, 0, 0, 0}, {1, 0, 2, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0},
    {2, 1, 0, 0, 0, 0, 0, 0}, {2, 1, 1, 2, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {1, 0, 0, 0, 0, 0, 0, 0}, {1, 0, 1, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}
};

/*
    @brief calculate number of flipped discs in the last move

    @param player               a bitboard representing player
    @param place                a place to put
    @return number of flipping discs
*/
inline int_fast8_t count_last_flip(uint64_t player, const uint_fast8_t place) {
    const int x = place & 7;
    const int y = place >> 3;
    return
        N_LAST_FLIP[join_h_line(player, y)][x] + 
        N_LAST_FLIP[join_v_line(player, x)][y] + 
        N_LAST_FLIP[join_d7_line(player, x + y)][std::min(y, 7 - x)] + 
        N_LAST_FLIP[join_d9_line(player, x + 7 - y)][std::min(y, x)];
}

inline void last_flip_init() {
}