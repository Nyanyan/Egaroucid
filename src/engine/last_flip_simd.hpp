/*
    Egaroucid Project

    @file last_flip_simd.hpp
        calculate number of flipped discs in the last move with SIMD
    @date 2021-2025
    @author Takuto Yamana
    @license GPL-3.0 license
*/

#pragma once
#include "setting.hpp"
#include "common.hpp"
#include "bit.hpp"

/*
    @brief constant of number of flipping discs
*/
#if LAST_FLIP_PASS_OPT
// N_LAST_FLIP_BOTH[player_8bit][place] = n_flip_opponent << 8 | n_flip_player
// opponent_8bit = 0xff ^ player_8bit ^ (1 << place)
constexpr uint16_t N_LAST_FLIP_BOTH[N_8BIT][HW] = {
    {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4, 0<<8|5, 0<<8|6},
    {1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4, 0<<8|5}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4, 0<<8|5},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|2, 0<<8|3, 0<<8|4},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2, 0<<8|3},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2, 0<<8|3}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2, 0<<8|3},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1, 0<<8|2, 0<<8|3}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|2, 0<<8|3},
    {0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2},
    {1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2},
    {0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2},
    {2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1, 0<<8|2},
    {0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2},
    {1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1, 0<<8|2},
    {0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1, 0<<8|2},
    {4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|1, 0<<8|2}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|2},
    {0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 1<<8|3, 0<<8|0, 1<<8|0, 0<<8|1},
    {1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|1},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|1},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|1},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|1},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 1<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|1},
    {0<<8|3, 0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1}, {0<<8|0, 0<<8|2, 0<<8|2, 2<<8|2, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1},
    {1<<8|0, 0<<8|0, 1<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1},
    {0<<8|1, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1}, {0<<8|0, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1},
    {2<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|1},
    {0<<8|2, 0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1}, {0<<8|0, 0<<8|1, 3<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1},
    {1<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|1},
    {0<<8|1, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|1}, {0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|1},
    {5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0, 0<<8|1}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1},
    {0<<8|5, 0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 1<<8|4, 0<<8|0, 1<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|3, 0<<8|3, 0<<8|3, 1<<8|3, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 1<<8|3, 0<<8|0, 1<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 1<<8|1, 0<<8|0, 1<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 1<<8|1, 0<<8|0, 1<<8|0},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|1, 1<<8|1, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0},
    {0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0},
    {1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0},
    {0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 1<<8|0},
    {4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0, 0<<8|0, 1<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0},
    {0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 2<<8|3, 0<<8|0, 0<<8|0, 2<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 2<<8|2, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 2<<8|2, 0<<8|0, 0<<8|0, 2<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 2<<8|0},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0, 0<<8|0, 0<<8|0, 2<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 3<<8|2, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 3<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 3<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0},
    {0<<8|2, 0<<8|1, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0}, {0<<8|0, 0<<8|1, 4<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0},
    {1<<8|0, 0<<8|0, 5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0}, {0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0},
    {0<<8|1, 5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0}, {0<<8|0, 5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0},
    {6<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 6<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|6, 0<<8|5, 0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|5, 0<<8|5, 0<<8|5, 0<<8|5, 0<<8|5, 0<<8|5, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|2, 0<<8|2, 0<<8|2, 0<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|2, 0<<8|2, 0<<8|2, 0<<8|0}, 
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|2, 0<<8|2, 0<<8|2, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 0<<8|2, 0<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0},
    {0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0},
    {1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0},
    {0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|1, 0<<8|1, 0<<8|0},
    {4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|1, 0<<8|1, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|1, 0<<8|0},
    {0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 1<<8|3, 0<<8|0, 1<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|0},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 1<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 2<<8|2, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 3<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0},
    {0<<8|1, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0}, {0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0},
    {5<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 5<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|5, 0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|4, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0, 0<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0, 0<<8|0},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|1, 0<<8|1, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|1, 0<<8|0, 0<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 1<<8|2, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 2<<8|1, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0},
    {4<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 4<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|4, 0<<8|3, 0<<8|2, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|3, 0<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 1<<8|1, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 3<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|3, 0<<8|2, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|2, 0<<8|2, 0<<8|2, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {2<<8|0, 0<<8|0, 0<<8|0, 2<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|2, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|1, 0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {1<<8|0, 0<<8|0, 1<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|1, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0},
    {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}, {0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0, 0<<8|0}
};
#endif

// if (i & (1 << j))  n_flip_pre_calc[i][j] = n_flip_pre_calc[i ^ (1 << j)][j];	// to use ~player instead of opponent
constexpr int_fast8_t n_flip_pre_calc[N_8BIT][HW] = {
    {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 1, 2, 3, 4, 5, 6}, {0, 0, 0, 1, 2, 3, 4, 5}, {0, 0, 0, 1, 2, 3, 4, 5}, {1, 0, 0, 0, 1, 2, 3, 4}, {1, 0, 1, 0, 1, 2, 3, 4}, {0, 0, 0, 0, 1, 2, 3, 4}, {0, 0, 0, 0, 1, 2, 3, 4},
    {2, 1, 0, 0, 0, 1, 2, 3}, {2, 1, 1, 2, 0, 1, 2, 3}, {0, 1, 0, 1, 0, 1, 2, 3}, {0, 1, 0, 1, 0, 1, 2, 3}, {1, 0, 0, 0, 0, 1, 2, 3}, {1, 0, 1, 0, 0, 1, 2, 3}, {0, 0, 0, 0, 0, 1, 2, 3}, {0, 0, 0, 0, 0, 1, 2, 3},
    {3, 2, 1, 0, 0, 0, 1, 2}, {3, 2, 2, 2, 3, 0, 1, 2}, {0, 2, 1, 1, 2, 0, 1, 2}, {0, 2, 1, 1, 2, 0, 1, 2}, {1, 0, 1, 0, 1, 0, 1, 2}, {1, 0, 2, 0, 1, 0, 1, 2}, {0, 0, 1, 0, 1, 0, 1, 2}, {0, 0, 1, 0, 1, 0, 1, 2},
    {2, 1, 0, 0, 0, 0, 1, 2}, {2, 1, 1, 2, 0, 0, 1, 2}, {0, 1, 0, 1, 0, 0, 1, 2}, {0, 1, 0, 1, 0, 0, 1, 2}, {1, 0, 0, 0, 0, 0, 1, 2}, {1, 0, 1, 0, 0, 0, 1, 2}, {0, 0, 0, 0, 0, 0, 1, 2}, {0, 0, 0, 0, 0, 0, 1, 2},
    {4, 3, 2, 1, 0, 0, 0, 1}, {4, 3, 3, 3, 3, 4, 0, 1}, {0, 3, 2, 2, 2, 3, 0, 1}, {0, 3, 2, 2, 2, 3, 0, 1}, {1, 0, 2, 1, 1, 2, 0, 1}, {1, 0, 3, 1, 1, 2, 0, 1}, {0, 0, 2, 1, 1, 2, 0, 1}, {0, 0, 2, 1, 1, 2, 0, 1},
    {2, 1, 0, 1, 0, 1, 0, 1}, {2, 1, 1, 3, 0, 1, 0, 1}, {0, 1, 0, 2, 0, 1, 0, 1}, {0, 1, 0, 2, 0, 1, 0, 1}, {1, 0, 0, 1, 0, 1, 0, 1}, {1, 0, 1, 1, 0, 1, 0, 1}, {0, 0, 0, 1, 0, 1, 0, 1}, {0, 0, 0, 1, 0, 1, 0, 1},
    {3, 2, 1, 0, 0, 0, 0, 1}, {3, 2, 2, 2, 3, 0, 0, 1}, {0, 2, 1, 1, 2, 0, 0, 1}, {0, 2, 1, 1, 2, 0, 0, 1}, {1, 0, 1, 0, 1, 0, 0, 1}, {1, 0, 2, 0, 1, 0, 0, 1}, {0, 0, 1, 0, 1, 0, 0, 1}, {0, 0, 1, 0, 1, 0, 0, 1},
    {2, 1, 0, 0, 0, 0, 0, 1}, {2, 1, 1, 2, 0, 0, 0, 1}, {0, 1, 0, 1, 0, 0, 0, 1}, {0, 1, 0, 1, 0, 0, 0, 1}, {1, 0, 0, 0, 0, 0, 0, 1}, {1, 0, 1, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 0, 0, 0, 1},
    {5, 4, 3, 2, 1, 0, 0, 0}, {5, 4, 4, 4, 4, 4, 5, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {1, 0, 3, 2, 2, 2, 3, 0}, {1, 0, 4, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0},
    {2, 1, 0, 2, 1, 1, 2, 0}, {2, 1, 1, 4, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {1, 0, 0, 2, 1, 1, 2, 0}, {1, 0, 1, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0},
    {3, 2, 1, 0, 1, 0, 1, 0}, {3, 2, 2, 2, 4, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {1, 0, 1, 0, 2, 0, 1, 0}, {1, 0, 2, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0},
    {2, 1, 0, 0, 1, 0, 1, 0}, {2, 1, 1, 2, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {1, 0, 0, 0, 1, 0, 1, 0}, {1, 0, 1, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0},
    {4, 3, 2, 1, 0, 0, 0, 0}, {4, 3, 3, 3, 3, 4, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {1, 0, 2, 1, 1, 2, 0, 0}, {1, 0, 3, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0},
    {2, 1, 0, 1, 0, 1, 0, 0}, {2, 1, 1, 3, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {1, 0, 0, 1, 0, 1, 0, 0}, {1, 0, 1, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0},
    {3, 2, 1, 0, 0, 0, 0, 0}, {3, 2, 2, 2, 3, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {1, 0, 1, 0, 1, 0, 0, 0}, {1, 0, 2, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0},
    {2, 1, 0, 0, 0, 0, 0, 0}, {2, 1, 1, 2, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {1, 0, 0, 0, 0, 0, 0, 0}, {1, 0, 1, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0},
    {6, 5, 4, 3, 2, 1, 0, 0}, {6, 5, 5, 5, 5, 5, 5, 6}, {0, 5, 4, 4, 4, 4, 4, 5}, {0, 5, 4, 4, 4, 4, 4, 5}, {1, 0, 4, 3, 3, 3, 3, 4}, {1, 0, 5, 3, 3, 3, 3, 4}, {0, 0, 4, 3, 3, 3, 3, 4}, {0, 0, 4, 3, 3, 3, 3, 4},
    {2, 1, 0, 3, 2, 2, 2, 3}, {2, 1, 1, 5, 2, 2, 2, 3}, {0, 1, 0, 4, 2, 2, 2, 3}, {0, 1, 0, 4, 2, 2, 2, 3}, {1, 0, 0, 3, 2, 2, 2, 3}, {1, 0, 1, 3, 2, 2, 2, 3}, {0, 0, 0, 3, 2, 2, 2, 3}, {0, 0, 0, 3, 2, 2, 2, 3},
    {3, 2, 1, 0, 2, 1, 1, 2}, {3, 2, 2, 2, 5, 1, 1, 2}, {0, 2, 1, 1, 4, 1, 1, 2}, {0, 2, 1, 1, 4, 1, 1, 2}, {1, 0, 1, 0, 3, 1, 1, 2}, {1, 0, 2, 0, 3, 1, 1, 2}, {0, 0, 1, 0, 3, 1, 1, 2}, {0, 0, 1, 0, 3, 1, 1, 2},
    {2, 1, 0, 0, 2, 1, 1, 2}, {2, 1, 1, 2, 2, 1, 1, 2}, {0, 1, 0, 1, 2, 1, 1, 2}, {0, 1, 0, 1, 2, 1, 1, 2}, {1, 0, 0, 0, 2, 1, 1, 2}, {1, 0, 1, 0, 2, 1, 1, 2}, {0, 0, 0, 0, 2, 1, 1, 2}, {0, 0, 0, 0, 2, 1, 1, 2},
    {4, 3, 2, 1, 0, 1, 0, 1}, {4, 3, 3, 3, 3, 5, 0, 1}, {0, 3, 2, 2, 2, 4, 0, 1}, {0, 3, 2, 2, 2, 4, 0, 1}, {1, 0, 2, 1, 1, 3, 0, 1}, {1, 0, 3, 1, 1, 3, 0, 1}, {0, 0, 2, 1, 1, 3, 0, 1}, {0, 0, 2, 1, 1, 3, 0, 1},
    {2, 1, 0, 1, 0, 2, 0, 1}, {2, 1, 1, 3, 0, 2, 0, 1}, {0, 1, 0, 2, 0, 2, 0, 1}, {0, 1, 0, 2, 0, 2, 0, 1}, {1, 0, 0, 1, 0, 2, 0, 1}, {1, 0, 1, 1, 0, 2, 0, 1}, {0, 0, 0, 1, 0, 2, 0, 1}, {0, 0, 0, 1, 0, 2, 0, 1},
    {3, 2, 1, 0, 0, 1, 0, 1}, {3, 2, 2, 2, 3, 1, 0, 1}, {0, 2, 1, 1, 2, 1, 0, 1}, {0, 2, 1, 1, 2, 1, 0, 1}, {1, 0, 1, 0, 1, 1, 0, 1}, {1, 0, 2, 0, 1, 1, 0, 1}, {0, 0, 1, 0, 1, 1, 0, 1}, {0, 0, 1, 0, 1, 1, 0, 1},
    {2, 1, 0, 0, 0, 1, 0, 1}, {2, 1, 1, 2, 0, 1, 0, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {1, 0, 0, 0, 0, 1, 0, 1}, {1, 0, 1, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 0, 1, 0, 1},
    {5, 4, 3, 2, 1, 0, 0, 0}, {5, 4, 4, 4, 4, 4, 5, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {0, 4, 3, 3, 3, 3, 4, 0}, {1, 0, 3, 2, 2, 2, 3, 0}, {1, 0, 4, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0}, {0, 0, 3, 2, 2, 2, 3, 0},
    {2, 1, 0, 2, 1, 1, 2, 0}, {2, 1, 1, 4, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {0, 1, 0, 3, 1, 1, 2, 0}, {1, 0, 0, 2, 1, 1, 2, 0}, {1, 0, 1, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0}, {0, 0, 0, 2, 1, 1, 2, 0},
    {3, 2, 1, 0, 1, 0, 1, 0}, {3, 2, 2, 2, 4, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {0, 2, 1, 1, 3, 0, 1, 0}, {1, 0, 1, 0, 2, 0, 1, 0}, {1, 0, 2, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0}, {0, 0, 1, 0, 2, 0, 1, 0},
    {2, 1, 0, 0, 1, 0, 1, 0}, {2, 1, 1, 2, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {0, 1, 0, 1, 1, 0, 1, 0}, {1, 0, 0, 0, 1, 0, 1, 0}, {1, 0, 1, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0}, {0, 0, 0, 0, 1, 0, 1, 0},
    {4, 3, 2, 1, 0, 0, 0, 0}, {4, 3, 3, 3, 3, 4, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {0, 3, 2, 2, 2, 3, 0, 0}, {1, 0, 2, 1, 1, 2, 0, 0}, {1, 0, 3, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0}, {0, 0, 2, 1, 1, 2, 0, 0},
    {2, 1, 0, 1, 0, 1, 0, 0}, {2, 1, 1, 3, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {0, 1, 0, 2, 0, 1, 0, 0}, {1, 0, 0, 1, 0, 1, 0, 0}, {1, 0, 1, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0}, {0, 0, 0, 1, 0, 1, 0, 0},
    {3, 2, 1, 0, 0, 0, 0, 0}, {3, 2, 2, 2, 3, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {0, 2, 1, 1, 2, 0, 0, 0}, {1, 0, 1, 0, 1, 0, 0, 0}, {1, 0, 2, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0}, {0, 0, 1, 0, 1, 0, 0, 0},
    {2, 1, 0, 0, 0, 0, 0, 0}, {2, 1, 1, 2, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {0, 1, 0, 1, 0, 0, 0, 0}, {1, 0, 0, 0, 0, 0, 0, 0}, {1, 0, 1, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}
};

#if USE_BIT_GATHER_OPTIMIZE_LAST_FLIP
__m128i last_flip_d9_d7_mask[HW2];
#endif

/*
    @brief calculate number of flipped discs in the last move

    @param player               a bitboard representing player
    @param place                a place to put
    @return number of flipping discs
*/
inline int_fast8_t count_last_flip(uint64_t player, const uint_fast8_t place) {
    const int t = place >> 3;
    const int u = place & 7;
#if USE_BIT_GATHER_OPTIMIZE_LAST_FLIP
    __m128i pp_128 = _mm_set1_epi64x(player);
    uint16_t d9_d7 = _mm_movemask_epi8(_mm_sub_epi8(_mm_setzero_si128(), _mm_and_si128(pp_128, last_flip_d9_d7_mask[place])));
    return
        n_flip_pre_calc[join_h_line(player, t)][u] + 
        n_flip_pre_calc[join_v_line(player, u)][t] + 
        n_flip_pre_calc[d9_d7 & 0xFF][t] + 
        n_flip_pre_calc[d9_d7 >> 8][t];
#else
    return
        n_flip_pre_calc[join_h_line(player, t)][u] + 
        n_flip_pre_calc[join_v_line(player, u)][t] + 
        n_flip_pre_calc[join_d7_line(player, u + t)][std::min(t, 7 - u)] + 
        n_flip_pre_calc[join_d9_line(player, u + 7 - t)][std::min(t, u)];
#endif
}

inline void last_flip_init() {
#if USE_BIT_GATHER_OPTIMIZE_LAST_FLIP
    for (int i = 0; i < HW2; ++i) {
        uint64_t d9 = 0ULL;
        uint64_t d7 = 0ULL;
        bool d9_wall = false;
        bool d7_wall = false;
        for (int j = 0; j < HW; ++j) {
            if (i + j * 9 < HW2 && !d9_wall) {
                d9 |= 1ULL << (i + j * 9);
                if (d9 & 0x8080808080808080ULL)
                    d9_wall = true;
            }
            if (i + j * 7 < HW2 && !d7_wall) {
                d7 |= 1ULL << (i + j * 7);
                if (d7 & 0x0101010101010101ULL)
                    d7_wall = true;
            }
        }
        d9_wall = false;
        d7_wall = false;
        for (int j = 0; j < HW; ++j) {
            if (i - j * 9 >= 0 && !d9_wall) {
                d9 |= 1ULL << (i - j * 9);
                if (d9 & 0x0101010101010101ULL)
                    d9_wall = true;
            }
            if (i - j * 7 >= 0 && !d7_wall) {
                d7 |= 1ULL << (i - j * 7);
                if (d7 & 0x8080808080808080ULL)
                    d7_wall = true;
            }
        }
        if (pop_count_ull(d9) <= 2)
            d9 = 0ULL;
        if (pop_count_ull(d7) <= 2)
            d7 = 0ULL;
        last_flip_d9_d7_mask[i] = _mm_set_epi64x(d9, d7);
    }
#endif
}